<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Updating the dependencies in Rperform. | Daniel Agyapong </title> <meta name="author" content="Daniel Agyapong"> <meta name="description" content="This is the total review of how I went about in fixing the issues with dependencies in Rperform package."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://engineerdanny.github.io/blog/2022/Updating-dependencies-In-Rperform/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Daniel</span> Agyapong </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">Daniel Agyapong, PhD Student </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Updating the dependencies in Rperform.</h1> <p class="post-meta"> Created in June 20, 2022 </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/category/rperform"> <i class="fa-solid fa-tag fa-sm"></i> Rperform</a>   <a href="/blog/category/performance"> <i class="fa-solid fa-tag fa-sm"></i> performance</a>   <a href="/blog/category/test"> <i class="fa-solid fa-tag fa-sm"></i> test</a>   <a href="/blog/category/r"> <i class="fa-solid fa-tag fa-sm"></i> r</a>   <a href="/blog/category/git"> <i class="fa-solid fa-tag fa-sm"></i> git</a>   <a href="/blog/category/github"> <i class="fa-solid fa-tag fa-sm"></i> github</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="introduction">Introduction</h1> <p>In R, it is the main purpose of the <code class="language-plaintext highlighter-rouge">DESCRIPTION</code> file to convey the metadata about a package. It is also needed to list all the dependencies that the package uses. Inside the <code class="language-plaintext highlighter-rouge">DESCRIPTION</code> file, there are <code class="language-plaintext highlighter-rouge">Imports</code> and <code class="language-plaintext highlighter-rouge">Suggests</code> section under which, you can list your dependencies. There is a minor difference between the two. The packages under <code class="language-plaintext highlighter-rouge">Imports</code> are needed by your users at runtime. <code class="language-plaintext highlighter-rouge">Packages</code> under <code class="language-plaintext highlighter-rouge">Suggests</code> however, may be optional because it is either used for development or optional functionalities. There was a major issue with the major dependencies used by <code class="language-plaintext highlighter-rouge">Rperform</code>. The issue was that, the versions of the dependencies used were too old and one of the them was discontinued.</p> <h2 id="the-git2r-package">The git2r package</h2> <p>The <code class="language-plaintext highlighter-rouge">git2r</code> package is a popular R package which is mainly known for using git with R. It gives users programmatic experience with git using R. It is very fast because it implements git core methods developed with C. As the developers of the package improved and updated the package, they made a breaking transition. They made a change in support from S4 objects to S3 objects. A simple fix to this issue will be to pin the version of the package to specific versions in the <code class="language-plaintext highlighter-rouge">DESCRIPTION</code> file. However, a lot of developers have always install the latest versions of packages. As I tested <code class="language-plaintext highlighter-rouge">Rperform</code> for the first time, I had the issue. This is the error I had :</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">plot_metrics</span><span class="p">(</span><span class="n">test_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tests/testthat/test-join.r"</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"time"</span><span class="p">,</span><span class="w"> </span><span class="n">num_commits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">save_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">save_plots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">Error</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">base</span><span class="o">::</span><span class="n">substr</span><span class="p">(</span><span class="n">commit_val</span><span class="o">@</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> 
  </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">slot</span><span class="w"> </span><span class="s2">"summary"</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="p">(</span><span class="n">class</span><span class="w"> </span><span class="s2">"git_commit"</span><span class="p">)</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">S4</span><span class="w"> </span><span class="n">object</span><span class="w"> 
</span></code></pre></div></div> <p>Analyzing the error message suggests that the program is trying to get a property from an object which is not S4 object but rather S3 object. The actual issue was that my <code class="language-plaintext highlighter-rouge">git2r</code> version was the latest version. For some reason, the package version which should have been pinned to be <code class="language-plaintext highlighter-rouge">&lt;= version 0.21.0</code> was ignored by my program. The fact is that, the latest <code class="language-plaintext highlighter-rouge">git2r</code> package has a lot of new features and fixes. The first task I had to do was updating Rperform to also support the newer versions of <code class="language-plaintext highlighter-rouge">git2r</code> so as to make it easier for other developers to use and test the package. I updated the <code class="language-plaintext highlighter-rouge">git2r</code> version to <code class="language-plaintext highlighter-rouge">(&gt;= 0.30.1)</code> in the <code class="language-plaintext highlighter-rouge">DESCRIPTION</code> file so it made some functions in the code obsolete. First of all, the names of some functions were updated. Refactoring the code was not difficult but running through the documentation of the <code class="language-plaintext highlighter-rouge">git2r</code> package and checking the newer functions proved to be a little challenging and time consuming. First major change I had to make was replace the <code class="language-plaintext highlighter-rouge">head</code> function to <code class="language-plaintext highlighter-rouge">repository_head</code> function. This function basically gets the <code class="language-plaintext highlighter-rouge">HEAD</code> of a repository.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># From</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">repo_head</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">git2r</span><span class="o">::</span><span class="n">head</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">repo_head</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">git2r</span><span class="o">::</span><span class="n">repository_head</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <p>Also, I had to check all the functions related to the issue to be compatible to S3 objects. Just to name a few, some of them are :</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># From</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">base</span><span class="o">::</span><span class="n">substr</span><span class="p">(</span><span class="n">commit_val</span><span class="o">@</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">)</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">repo_head</span><span class="o">@</span><span class="n">name</span><span class="w">
</span></code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">base</span><span class="o">::</span><span class="n">substr</span><span class="p">(</span><span class="n">commit_val</span><span class="o">$</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">)</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">repo_head</span><span class="o">$</span><span class="n">name</span><span class="w">
</span></code></pre></div></div> <p>Initially, I used numeric indexes to reference list members. I switched to using named reference approach to reference list members by names instead of numeric indexes because it was less error prone. With most of the changes just like above examples, I just had to replace the <code class="language-plaintext highlighter-rouge">@</code> symbol with the <code class="language-plaintext highlighter-rouge">$</code> symbol. Others were a little more complex than that.</p> <h2 id="the-animint-dependency">The Animint dependency</h2> <p>The <a href="https://github.com/tdhock/animint" rel="external nofollow noopener" target="_blank">animint</a> package is a forked version of the <code class="language-plaintext highlighter-rouge">ggplot2</code> with improved features. It enables developers to design multi-plot, multi-layer, interactive and animated data visualizations. Unfortunately, the original version has been discontinued. Even though, it was an optional package in the root <code class="language-plaintext highlighter-rouge">DESCRIPTION</code> file, it was worth looking into. However, my attention only drew to it when I was running a <code class="language-plaintext highlighter-rouge">CMD R Check</code> on the <code class="language-plaintext highlighter-rouge">Rperform</code> package and it failed. The Github CI test showed that it is not possible to install it because it could not recognize the package. After digging into the issue, I realized the package has been discontinued. Fast forward, there is an updated version called the <a href="https://github.com/tdhock/animint2" rel="external nofollow noopener" target="_blank">animint2</a> which comes with easier installation and better syntax. Therefore I updated the package to <code class="language-plaintext highlighter-rouge">animint2</code> in the <code class="language-plaintext highlighter-rouge">DESCRIPTION</code> file. Then, I checked and tested all the functions that depend on the animint2 package. Most of them had to do with just replacing <code class="language-plaintext highlighter-rouge">animint</code> with <code class="language-plaintext highlighter-rouge">animint2</code>.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># From</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">animint</span><span class="o">::</span><span class="n">theme_animint</span><span class="p">(</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">700</span><span class="p">)</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">animint</span><span class="o">::</span><span class="n">animint2dir</span><span class="p">(</span><span class="n">plot.list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viz.list</span><span class="p">,</span><span class="w"> </span><span class="n">out.dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">getwd</span><span class="p">()),</span><span class="w"> </span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="s2">"time_animint"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">animint2</span><span class="o">::</span><span class="n">theme_animint</span><span class="p">(</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">700</span><span class="p">)</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">animint2</span><span class="o">::</span><span class="n">animint2dir</span><span class="p">(</span><span class="n">plot.list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viz.list</span><span class="p">,</span><span class="w"> </span><span class="n">out.dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">getwd</span><span class="p">()),</span><span class="w"> </span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="s2">"time_animint"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <h2 id="fix-dependency-and-related-issues">Fix dependency and related issues</h2> <p>After all the changes and updates, I opened a Pull Request to address the issues. <a href="https://github.com/EngineerDanny/Rperform/pull/2" rel="external nofollow noopener" target="_blank">PR#2</a> and <a href="https://github.com/EngineerDanny/Rperform/pull/3" rel="external nofollow noopener" target="_blank">PR#3</a>. As it was a pending issue raised twice on the main repository. These combined <a href="https://github.com/analyticalmonk/Rperform/pull/47" rel="external nofollow noopener" target="_blank">PRs</a> close issues <a href="https://github.com/analyticalmonk/Rperform/issues/44" rel="external nofollow noopener" target="_blank">#44</a> and <a href="https://github.com/analyticalmonk/Rperform/issues/45" rel="external nofollow noopener" target="_blank">#45</a>.</p> <h1 id="conclusion">Conclusion</h1> <p>I have realized that the dependencies that our projects utilize are very crucial to the development of the package and its users. At first, I nearly gave up on the <code class="language-plaintext highlighter-rouge">Rperform</code> package because of it’s support for old dependencies which were not already installed and for some reason could not get installed on my computer. Updating dependencies ensures the package gets access to the latest features, improvements and bug fixes. Downgrading the <code class="language-plaintext highlighter-rouge">git2r</code> dependency was a temporal fix, updating and ensuring that all related issues are fixed became the permanent fix.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/RPerform-R-CMD-Check/">R CMD Check on Rperform</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Rperform-Compilation-Errors-And-Fixes/">Fixes to some of the compilation errors of Rperform</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Implementing-Custom-Github-Actions-in-Rperform/">Implementing Custom Github Action Prototype in Rperform</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Touchstone-Test-1/">Testing Touchstone with a simple For Loop</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/RPerform/">Sample RPerform package usage</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Daniel Agyapong. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>